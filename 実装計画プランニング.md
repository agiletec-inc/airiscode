# airiscode å®Ÿè£…è¨ˆç”»ãƒ—ãƒ©ãƒ³ãƒ‹ãƒ³ã‚°

**ä½œæˆæ—¥**: 2025-11-09
**æ›´æ–°æ—¥**: 2025-11-09
**å¯¾è±¡**: airiscode monorepo (pnpm + Turbo)
**ç›®æ¨™**: ARCHTECHTURE.mdã§å®šç¾©ã•ã‚ŒãŸãƒ“ã‚¸ãƒ§ãƒ³ã‚’æ®µéšçš„ã«å®Ÿè£…

---

## 1. èƒŒæ™¯ã¨ç›®çš„

### ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ¦‚è¦
`ARCHTECHTURE.md`ã§å®šç¾©ã•ã‚ŒãŸ **Super Agent + MindBase + AIRIS MCP Gateway** ã®çµ±åˆãƒ“ã‚¸ãƒ§ãƒ³ã‚’ã€å®Ÿéš›ã®pnpm + Turboãƒ¢ãƒãƒ¬ãƒã§å…·ç¾åŒ–ã™ã‚‹ã€‚

### ç›®çš„
ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ãƒ•ã‚¡ãƒ¼ã‚¹ãƒˆãª`apps/airiscode-cli`ã‚’MVPãƒ¬ãƒ™ãƒ«ã¾ã§æ§‹ç¯‰ã—ã€ä»¥ä¸‹ã‚’å®Ÿç¾:
- è¤‡æ•°ã®LLMãƒ‰ãƒ©ã‚¤ãƒãƒ¼(OpenAI/Anthropic/Google/Ollama/MLX)ã®çµ±ä¸€API
- è¤‡æ•°ã®CLIã‚¢ãƒ€ãƒ—ã‚¿ãƒ¼(Codex/Claude Code/Gemini CLI/Aider)ã®å­ãƒ—ãƒ­ã‚»ã‚¹åˆ¶å¾¡
- å³æ ¼ãªãƒãƒªã‚·ãƒ¼ç®¡ç†(Shell Guardã€Approvals/Trust ãƒ¬ãƒ™ãƒ«)
- MCP GatewayçµŒç”±ã®å‹•çš„ãƒ„ãƒ¼ãƒ«æä¾›
- MindBaseé€£æºã«ã‚ˆã‚‹æ°¸ç¶šçš„ãªã‚»ãƒƒã‚·ãƒ§ãƒ³è¨˜æ†¶

---

## 2. å®Ÿè£…æˆ¦ç•¥ã®å…¨ä½“æ–¹é‡

### ã‚¢ãƒ—ãƒ­ãƒ¼ãƒ
1. **ãƒœãƒˆãƒ ã‚¢ãƒƒãƒ—æ§‹ç¯‰**: ä¾å­˜é–¢ä¿‚ã®å°‘ãªã„ã‚³ã‚¢ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‹ã‚‰å®Ÿè£…
2. **æ®µéšçš„çµ±åˆ**: å„ãƒ•ã‚§ãƒ¼ã‚ºã§å‹•ä½œæ¤œè¨¼å¯èƒ½ãªæœ€å°å˜ä½(Incremental MVP)ã‚’æ§‹ç¯‰
3. **ä¸¦è¡Œé–‹ç™º**: ç‹¬ç«‹ã—ãŸãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã¯è¤‡æ•°ã®ãƒãƒ¼ãƒ ãƒ¡ãƒ³ãƒãƒ¼ãŒä¸¦è¡Œå®Ÿè£…å¯èƒ½

### æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯
| ã‚«ãƒ†ã‚´ãƒª | é¸å®šæŠ€è¡“ | ç†ç”± |
|---------|---------|------|
| **è¨€èª** | TypeScript (strict mode) | å‹å®‰å…¨æ€§ã€ã‚¨ã‚³ã‚·ã‚¹ãƒ†ãƒ  |
| **ãƒ“ãƒ«ãƒ‰** | Turbo + pnpm workspaces | ãƒ¢ãƒãƒ¬ãƒæœ€é©åŒ–ã€é«˜é€Ÿã‚­ãƒ£ãƒƒã‚·ãƒ¥ |
| **CLI** | Commander.js + Ink | å®£è¨€çš„ã‚³ãƒãƒ³ãƒ‰å®šç¾©ã€Reacté¢¨TUI |
| **ãƒ†ã‚¹ãƒˆ** | Vitest | é«˜é€Ÿã€ESMå¯¾å¿œã€Viteçµ±åˆ |
| **ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³** | Zod | ãƒ©ãƒ³ã‚¿ã‚¤ãƒ å‹ãƒã‚§ãƒƒã‚¯ã€ã‚¹ã‚­ãƒ¼ãƒé§†å‹• |
| **IPC** | JSON over STDIO â†’ gRPC (Phase 11) | åˆæœŸã¯è»½é‡ã€å°†æ¥ã¯å‹å®‰å…¨ãªé€šä¿¡ |
| **ãƒ—ãƒ­ã‚»ã‚¹ç®¡ç†** | execa | Promise-basedã€ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚° |
| **HTTP/SSE** | node-fetch / eventsource | MCP Gatewayé€šä¿¡ |

---

## 3. ãƒ¢ãƒãƒ¬ãƒæ§‹é€ 

```
airiscode/
â”œâ”€ apps/
â”‚  â””â”€ airiscode-cli/                # ãƒ¡ã‚¤ãƒ³CLI (Commander + Ink)
â”‚     â”œâ”€ src/
â”‚     â”‚  â”œâ”€ index.ts                # ã‚¨ãƒ³ãƒˆãƒªãƒ¼ãƒã‚¤ãƒ³ãƒˆ
â”‚     â”‚  â”œâ”€ commands/               # CLI ã‚³ãƒãƒ³ãƒ‰å®Ÿè£…
â”‚     â”‚  â”œâ”€ session/                # ã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç†
â”‚     â”‚  â””â”€ ui/                     # Ink ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
â”‚     â””â”€ package.json
â”‚
â”œâ”€ packages/
â”‚  â”œâ”€ types/                        # å…±é€šå‹å®šç¾©
â”‚  â”œâ”€ policies/                     # PolicyProfile, Approvals/Trust enum
â”‚  â”œâ”€ sandbox/                      # Shell Guard (deny/allow list)
â”‚  â”œâ”€ drivers/                      # ModelDriver ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹
â”‚  â”‚  â”œâ”€ openai/                    # OpenAI Driverå®Ÿè£…
â”‚  â”‚  â”œâ”€ anthropic/                 # Anthropic Driverå®Ÿè£…
â”‚  â”‚  â”œâ”€ google/                    # Google (Gemini) Driverå®Ÿè£…
â”‚  â”‚  â”œâ”€ local/                     # Ollama Driverå®Ÿè£…
â”‚  â”‚  â”œâ”€ mlx/                       # MLX Driverå®Ÿè£…
â”‚  â”‚  â””â”€ remote-gpu/                # Remote GPU Driverå®Ÿè£…
â”‚  â”œâ”€ adapters/                     # AdapterProcess ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹
â”‚  â”‚  â”œâ”€ codex/                     # Codex Adapterå®Ÿè£…
â”‚  â”‚  â”œâ”€ claude-code/               # Claude Code Adapterå®Ÿè£…
â”‚  â”‚  â”œâ”€ gemini-cli/                # Gemini CLI Adapterå®Ÿè£…
â”‚  â”‚  â””â”€ aider/                     # Aider Adapterå®Ÿè£…
â”‚  â”œâ”€ mcp/
â”‚  â”‚  â”œâ”€ client/                    # MCP Client (HTTP/SSE)
â”‚  â”‚  â””â”€ registry/                  # Tool Registry (lazy loading)
â”‚  â”œâ”€ runners/                      # Git/Docker/Test Runners
â”‚  â”‚  â”œâ”€ git/                       # Gitæ“ä½œè‡ªå‹•åŒ–
â”‚  â”‚  â”œâ”€ docker/                    # Docker Composeåˆ¶å¾¡
â”‚  â”‚  â””â”€ test/                      # ãƒ†ã‚¹ãƒˆå®Ÿè¡Œãƒ©ãƒ³ãƒŠãƒ¼
â”‚  â”œâ”€ super-agent/                  # Super Agent Runtime ãƒ©ãƒƒãƒ‘ãƒ¼
â”‚  â”œâ”€ mindbase/                     # MindBase Client
â”‚  â””â”€ ux/                           # å…±é€šUI/ãƒ¬ãƒãƒ¼ãƒˆæ©Ÿèƒ½
â”‚
â”œâ”€ tools/
â”‚  â””â”€ make/                         # å†ç¾å¯èƒ½ãªMakeã‚¿ã‚¹ã‚¯
â”‚     â”œâ”€ setup                      # é–‹ç™ºç’°å¢ƒã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
â”‚     â”œâ”€ test                       # çµ±åˆãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
â”‚     â””â”€ bench                      # ãƒ™ãƒ³ãƒãƒãƒ¼ã‚¯å®Ÿè¡Œ
â”‚
â”œâ”€ docs/                            # ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ
â”‚  â”œâ”€ ARCHTECHTURE.md               # ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£å®šç¾©
â”‚  â”œâ”€ AGENTS.md                     # ãƒªãƒã‚¸ãƒˆãƒªã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³
â”‚  â”œâ”€ CLAUDE.md                     # Claude Codeç”¨ã‚¬ã‚¤ãƒ‰
â”‚  â””â”€ å®Ÿè£…è¨ˆç”»ãƒ—ãƒ©ãƒ³ãƒ‹ãƒ³ã‚°.md         # ã“ã®ãƒ•ã‚¡ã‚¤ãƒ«
â”‚
â”œâ”€ pnpm-workspace.yaml              # pnpm workspaceè¨­å®š
â”œâ”€ turbo.json                       # Turbo pipelineå®šç¾©
â”œâ”€ tsconfig.base.json               # å…±é€šTypeScriptè¨­å®š
â””â”€ package.json                     # ãƒ«ãƒ¼ãƒˆpackage.json
```

---

## 4. ãƒ•ã‚§ãƒ¼ã‚ºåˆ¥å®Ÿè£…è¨ˆç”»

### Phase 0: ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆåŸºç›¤æ§‹ç¯‰ (1-2é€±é–“)

#### ç›®æ¨™
Turbo monorepoã®åŸºæœ¬æ§‹é€ ã‚’ç¢ºç«‹ã—ã€CI/CDãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã‚’æ•´å‚™

#### ã‚¿ã‚¹ã‚¯

**0.1 MonorepoåˆæœŸåŒ–**
- [ ] `pnpm-workspace.yaml` ä½œæˆ
- [ ] `turbo.json` è¨­å®š (build/lint/test/dev ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³å®šç¾©)
- [ ] ãƒ«ãƒ¼ãƒˆ `package.json` ã«å…±é€šdevDependenciesè¿½åŠ 
- [ ] å…±é€š `tsconfig.base.json` ä½œæˆ (strict: true)

**0.2 ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚¹ã‚±ãƒ«ãƒˆãƒ³ä½œæˆ**
å„ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã«ä»¥ä¸‹ã‚’é…ç½®:
- `package.json` (name, version, main, types, scripts)
- `tsconfig.json` (extends: "../../tsconfig.base.json")
- `src/index.ts` (ç©ºã®export)
- `__tests__/index.spec.ts` (ãƒ€ãƒŸãƒ¼ãƒ†ã‚¹ãƒˆ)

**0.3 CI/CD ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—**
- [ ] GitHub Actions è¨­å®š
- [ ] `tools/make/setup`, `tools/make/test` ã‚¹ã‚¯ãƒªãƒ—ãƒˆä½œæˆ

**0.4 ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆæ•´å‚™**
- [ ] `README.md` ã«ã‚¯ã‚¤ãƒƒã‚¯ã‚¹ã‚¿ãƒ¼ãƒˆæ‰‹é †è¿½åŠ 
- [ ] `CONTRIBUTING.md` ä½œæˆ

**å®Œäº†åŸºæº–**: `pnpm turbo run build lint test` ãŒã™ã¹ã¦ã®ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã§æˆåŠŸ

---

### Phase 1: ã‚³ã‚¢ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹å®Ÿè£… (2-3é€±é–“)

#### ç›®æ¨™
ãƒãƒªã‚·ãƒ¼ã€Shell Guardã€ModelDriver/AdapterProcessã®å‹å®šç¾©ã¨ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã‚’ç¢ºç«‹

#### 1.1 `packages/policies` - ãƒãƒªã‚·ãƒ¼ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«

**ä¾å­˜**: ãªã—

**å®Ÿè£…å†…å®¹**:
```typescript
// packages/policies/src/types.ts
export enum ApprovalsLevel {
  NEVER = 'never',
  ON_FAILURE = 'on-failure',
  ON_REQUEST = 'on-request',
}

export enum TrustLevel {
  RESTRICTED = 'restricted',
  SANDBOXED = 'sandboxed',
  UNTRUSTED = 'untrusted',
}

export interface PolicyProfile {
  approvals: ApprovalsLevel;
  trust: TrustLevel;
  guardStrict: boolean;
}

export const DEFAULT_POLICY: PolicyProfile = {
  approvals: ApprovalsLevel.ON_FAILURE,
  trust: TrustLevel.SANDBOXED,
  guardStrict: true,
};
```

**ãƒ†ã‚¹ãƒˆ**:
- [ ] ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ã®ã‚·ãƒªã‚¢ãƒ©ã‚¤ã‚º/ãƒ‡ã‚·ãƒªã‚¢ãƒ©ã‚¤ã‚º
- [ ] Zodãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
- [ ] ç„¡åŠ¹ãªçµ„ã¿åˆã‚ã›ã®æ¤œå‡º

---

#### 1.2 `packages/sandbox` - Shell Guard

**ä¾å­˜**: `packages/policies`

**å®Ÿè£…å†…å®¹**:
```typescript
// packages/sandbox/src/shell-guard.ts
import { PolicyProfile, TrustLevel } from '@airiscode/policies';

export interface GuardResult {
  allowed: boolean;
  reason?: string;
  rewritten?: string;
}

export class ShellGuard {
  private denyList: RegExp[] = [
    /rm\s+-rf\s+\//,
    /rm\s+-rf\s+~/,
    /:\(\)\s*{\s*:\|:&\s*};:/,  // fork bomb
    /mkfs/,
    /dd\s+if=.*of=\/dev\//,
    /docker\s+system\s+prune\s+-af/,
    /curl.*\|\s*sudo\s+bash/,
    /chmod\s+-R\s+777\s+\//,
  ];

  constructor(private policy: PolicyProfile) {}

  evaluate(command: string): GuardResult {
    // RESTRICTED: ã™ã¹ã¦æ‹’å¦
    if (this.policy.trust === TrustLevel.RESTRICTED) {
      return { allowed: false, reason: 'Shell disabled in restricted mode' };
    }

    // Deny listãƒã‚§ãƒƒã‚¯
    for (const pattern of this.denyList) {
      if (pattern.test(command)) {
        return { allowed: false, reason: `Dangerous command blocked: ${pattern}` };
      }
    }

    // SANDBOXED: ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯/å¤–éƒ¨ã‚¢ã‚¯ã‚»ã‚¹åˆ¶é™
    if (this.policy.trust === TrustLevel.SANDBOXED) {
      if (this.isNetworkCommand(command)) {
        return { allowed: false, reason: 'Network access blocked in sandboxed mode' };
      }
    }

    return { allowed: true };
  }

  private isNetworkCommand(command: string): boolean {
    const networkPatterns = [/curl/, /wget/, /ssh/, /scp/, /rsync/];
    return networkPatterns.some(p => p.test(command));
  }
}
```

**ãƒ†ã‚¹ãƒˆ**:
- [ ] å„denyãƒ‘ã‚¿ãƒ¼ãƒ³ãŒæ­£ã—ããƒ–ãƒ­ãƒƒã‚¯ã•ã‚Œã‚‹
- [ ] Trust levelã”ã¨ã®æŒ™å‹•ç¢ºèª
- [ ] å®‰å…¨ãªã‚³ãƒãƒ³ãƒ‰ã¯é€šéã™ã‚‹

---

#### 1.3 `packages/drivers` - ModelDriver ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹

**ä¾å­˜**: `packages/policies`

**å®Ÿè£…å†…å®¹**:
```typescript
// packages/drivers/src/types.ts
import { PolicyProfile } from '@airiscode/policies';

export interface ToolSpec {
  name: string;
  description: string;
  parameters: Record<string, unknown>;
}

export interface ChatMessage {
  role: 'system' | 'user' | 'assistant' | 'tool';
  content: string;
  toolName?: string;
}

export interface ToolCall {
  id: string;
  name: string;
  arguments: Record<string, unknown>;
}

export interface ChatRequest {
  sessionId: string;
  messages: ChatMessage[];
  tools?: ToolSpec[];
  policy: PolicyProfile;
  modelHints?: Record<string, string>;
}

export interface ChatResponse {
  text: string;
  toolCalls?: ToolCall[];
  incomplete: boolean;
}

export interface Capabilities {
  models: string[];
  supportsTools: boolean;
  supportsStream: boolean;
  apiVersion: string;
}

export abstract class ModelDriver {
  abstract getCapabilities(): Promise<Capabilities>;
  abstract chat(request: ChatRequest): Promise<ChatResponse>;
  abstract chatStream(request: ChatRequest): AsyncIterable<ChatResponse>;
}
```

---

#### 1.4 `packages/adapters` - AdapterProcess ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹

**ä¾å­˜**: `packages/policies`, `packages/sandbox`

**å®Ÿè£…å†…å®¹**:
```typescript
// packages/adapters/src/adapter.ts
import { PolicyProfile } from '@airiscode/policies';
import { ShellGuard } from '@airiscode/sandbox';

export interface SpawnOptions {
  adapterName: string;
  env: Record<string, string>;
  policy: PolicyProfile;
  sessionId: string;
}

export interface ExecuteRequest {
  action: string;
  inputJson: string;
}

export interface ExecuteResponse {
  outputJson: string;
  proposedShell: string[];
}

export abstract class AdapterProcess {
  protected guard: ShellGuard;

  constructor(protected options: SpawnOptions) {
    this.guard = new ShellGuard(options.policy);
  }

  abstract spawn(): Promise<void>;
  abstract execute(request: ExecuteRequest): Promise<ExecuteResponse>;
  abstract streamLogs(): AsyncIterable<string>;
  abstract requestShell(command: string): Promise<{ allowed: boolean; exitCode?: number; log?: string }>;
  abstract terminate(): Promise<void>;
}
```

**å®Œäº†åŸºæº–**: ã™ã¹ã¦ã®ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ãŒå‹å®šç¾©ã•ã‚Œã€ãƒ¢ãƒƒã‚¯å®Ÿè£…ã§ãƒ†ã‚¹ãƒˆå¯èƒ½

---

### Phase 2: åŸºæœ¬ãƒ‰ãƒ©ã‚¤ãƒãƒ¼/ã‚¢ãƒ€ãƒ—ã‚¿ãƒ¼å®Ÿè£… (3-4é€±é–“)

#### 2.1 `packages/drivers/local` - Ollama Driver

**å®Ÿè£…**: Ollama API (`/api/chat`, `/api/tags`) ã¨çµ±åˆ

**ãƒ†ã‚¹ãƒˆ**:
- [ ] ãƒ¢ãƒ‡ãƒ«ä¸€è¦§å–å¾—
- [ ] ãƒãƒ£ãƒƒãƒˆå®Ÿè¡Œ
- [ ] ã‚¹ãƒˆãƒªãƒ¼ãƒ ãƒ¬ã‚¹ãƒãƒ³ã‚¹
- [ ] ãƒ„ãƒ¼ãƒ«å‘¼ã³å‡ºã—

---

#### 2.2 `packages/adapters/claude-code` - Claude Code Adapter

**å®Ÿè£…**: `claude --json` ã‚’å­ãƒ—ãƒ­ã‚»ã‚¹ã¨ã—ã¦èµ·å‹•ã€JSON over STDIOé€šä¿¡

**ãƒ†ã‚¹ãƒˆ**:
- [ ] ãƒ—ãƒ­ã‚»ã‚¹èµ·å‹•/çµ‚äº†
- [ ] STDIOé€šä¿¡
- [ ] Shell Guardãƒ–ãƒ­ãƒƒã‚¯å‹•ä½œ

---

#### 2.3 çµ±åˆãƒ†ã‚¹ãƒˆ

**ã‚·ãƒŠãƒªã‚ª**:
1. OllamaDriver ã§ãƒãƒ£ãƒƒãƒˆé–‹å§‹
2. Claude Code Adapter ã«å®Ÿè£…ã‚¿ã‚¹ã‚¯ã‚’å§”è­²
3. Adapter ãŒ `git diff` ã‚’ææ¡ˆ â†’ Shell Guard ãŒè¨±å¯
4. Adapter ãŒ `rm -rf /` ã‚’ææ¡ˆ â†’ Shell Guard ãŒãƒ–ãƒ­ãƒƒã‚¯

**å®Œäº†åŸºæº–**: Ollama + Claude Codeã§E2Eãƒ•ãƒ­ãƒ¼ãŒå‹•ä½œ

---

### Phase 3: MCPçµ±åˆ (3-4é€±é–“)

#### 3.1 `packages/mcp/client` - MCP Client

**å®Ÿè£…**: AIRIS MCP Gateway ã¨ HTTP/SSE ã§é€šä¿¡

**ãƒ†ã‚¹ãƒˆ**:
- [ ] ãƒ„ãƒ¼ãƒ«ä¸€è¦§å–å¾—
- [ ] ãƒ„ãƒ¼ãƒ«è©³ç´°å–å¾—(é…å»¶ãƒ­ãƒ¼ãƒ‰)
- [ ] ãƒ„ãƒ¼ãƒ«å®Ÿè¡Œ

---

#### 3.2 `packages/mcp/registry` - Tool Registry

**å®Ÿè£…**: ãƒ„ãƒ¼ãƒ«ã®ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã¨é…å»¶ãƒ­ãƒ¼ãƒ‰ç®¡ç†

**ãƒ†ã‚¹ãƒˆ**:
- [ ] ã‚­ãƒ£ãƒƒã‚·ãƒ¥å‹•ä½œ
- [ ] é…å»¶ãƒ­ãƒ¼ãƒ‰
- [ ] ãƒ„ãƒ¼ãƒ«å®Ÿè¡Œ

**å®Œäº†åŸºæº–**: MCP GatewayçµŒç”±ã§ãƒ„ãƒ¼ãƒ«ä¸€è¦§å–å¾—ãƒ»å®Ÿè¡ŒãŒå¯èƒ½

---

### Phase 4: Runnerså®Ÿè£… (2-3é€±é–“)

#### 4.1 `packages/runners/git` - Git Runner

**å®Ÿè£…**: Gitæ“ä½œã®è‡ªå‹•åŒ– (apply, add, commit, test)

**ãƒ†ã‚¹ãƒˆ**:
- [ ] Git apply
- [ ] Git add/commit
- [ ] ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
- [ ] Shell Guardãƒ–ãƒ­ãƒƒã‚¯

---

#### 4.2 `packages/runners/docker` - Docker Runner

**å®Ÿè£…**: Docker Composeæ“ä½œ (up, health check, logs)

**ãƒ†ã‚¹ãƒˆ**:
- [ ] Compose up
- [ ] ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯
- [ ] ãƒ­ã‚°å–å¾—

**å®Œäº†åŸºæº–**: Git/Dockerãƒ©ãƒ³ãƒŠãƒ¼ãŒè‡ªå‹•åŒ–ã•ã‚Œã€Shell Guardçµ±åˆæ¸ˆã¿

---

### Phase 5: CLIå®Ÿè£… (4-5é€±é–“)

#### 5.1 ã‚³ãƒãƒ³ãƒ‰æ§‹é€ 

```bash
airis code <prompt> [options]
  --approvals=never|on-failure|on-request
  --trust=restricted|sandboxed|untrusted
  --adapters=codex,claude-code,gemini-cli,aider
  --tools=mcp:supabase,mcp:mindbase
  --driver=ollama|openai|anthropic
  --json

airis config set/get/list
airis session list/resume/delete
```

---

#### 5.2 TUIè¨­è¨ˆ (Ink)

```
â”Œâ”€ Task Log â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€ Diff Preview â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ [1/5] Planning...           â”‚ + export function hello() { â”‚
â”‚ [2/5] Implementing... â—     â”‚ +   return 'Hello';         â”‚
â”‚ [3/5] Testing...            â”‚ + }                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Policy: approvals=on-failure trust=sandboxed              â”‚
â”‚ Driver: ollama (qwen2.5-coder:7b)                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
Keys: j/k=scroll D=diff r=retry a=approve q=quit
```

**å®Œäº†åŸºæº–**: TUIã§ã‚¿ã‚¹ã‚¯é€²è¡Œå¯è¦–åŒ–ã€`--json`ãƒ¢ãƒ¼ãƒ‰å¯¾å¿œã€E2Eãƒ•ãƒ­ãƒ¼å®Œèµ°

---

### Phase 6-10: é«˜åº¦ãªçµ±åˆ

- **Phase 6**: Super Agentçµ±åˆ (3-4é€±)
- **Phase 7**: MindBaseçµ±åˆ (2-3é€±)
- **Phase 8**: è¿½åŠ ãƒ‰ãƒ©ã‚¤ãƒãƒ¼/ã‚¢ãƒ€ãƒ—ã‚¿ãƒ¼ (ä¸¦è¡Œå¯èƒ½)
- **Phase 9**: æœ€é©åŒ–ãƒ»ãƒ™ãƒ³ãƒãƒãƒ¼ã‚¯ (2é€±)
- **Phase 10**: ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆãƒ»ãƒªãƒªãƒ¼ã‚¹æº–å‚™ (1-2é€±)

---

## 5. CLI ã‚¢ãƒ€ãƒ—ã‚¿ãƒ¼å¼·åŒ–æˆ¦ç•¥(ã„ã„ã¨ã“å–ã‚Š)

### 1. Claude Code
- **å¼·ã¿**: å¤§è¦æ¨¡ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®æ–‡è„ˆç†è§£ã¨å·®åˆ†æ¨è«–
- **æ–½ç­–**: diffå–å¾—ã‚„`ARCHTECHTURE.md`è¦ç´„ã‚’è‡ªå‹•æ³¨å…¥ã€è¨­è¨ˆãƒ¬ãƒ“ãƒ¥ãƒ¼/ã‚³ãƒ¼ãƒ‰ç†è§£ã‚’æ‹…å½“

### 2. Codex CLI
- **å¼·ã¿**: ã‚¹ã‚¿ã‚¤ãƒ«ã‚¬ã‚¤ãƒ‰é©åˆã¨é«˜å“è³ªãªã‚³ãƒ¼ãƒ‰ç”Ÿæˆ
- **æ–½ç­–**: `packages/*`ã§ã®å®Ÿè£…ã‚„ãƒ†ã‚¹ãƒˆã‚³ãƒ¼ãƒ‰ç”Ÿæˆã‚’æ‹…å½“ã€Lint/TypeCheckè‡ªå‹•èµ·å‹•

### 3. Gemini CLI
- **å¼·ã¿**: ææ¡ˆã‚’å…·ä½“åŒ–ã—å®Ÿè¡Œã¾ã§é€²ã‚ã‚‹ãƒ‰ãƒ©ã‚¤ãƒ–åŠ›
- **æ–½ç­–**: Runnerå‘¼ã³å‡ºã—ã‚„`pnpm turbo run test`ã®ã‚ˆã†ãªç¢ºèªä»˜ãã‚³ãƒãƒ³ãƒ‰ã‚’æ‹…å½“

### 4. ã‚¢ã‚°ãƒªã‚²ãƒ¼ã‚·ãƒ§ãƒ³æ–¹é‡
- Super Agentã®ãƒ—ãƒ©ãƒ³ãƒŠãƒ¼ãŒå„ãƒ•ã‚§ãƒ¼ã‚º(ç†è§£â†’è¨­è¨ˆâ†’å®Ÿè£…â†’å®Ÿè¡Œ)ã«æœ€é©ãªCLIã‚’å‰²ã‚Šå½“ã¦
- Shell Guard/Policy ProfileãŒå…±é€šã§ã‚³ãƒãƒ³ãƒ‰ã‚’ä»²è£
- æˆæœç‰©ã¯MindBaseã«ç´ä»˜ã‘ã€æ¬¡ãƒ•ã‚§ãƒ¼ã‚ºã®CLIã¸å—ã‘æ¸¡ã—

---

## 6. å®Ÿè£…å„ªå…ˆé †ä½ãƒãƒˆãƒªã‚¯ã‚¹

| Phase | æœŸé–“ | ä¸¦è¡Œ | ãƒ–ãƒ­ãƒƒã‚«ãƒ¼ | å„ªå…ˆåº¦ |
|-------|------|------|-----------|--------|
| Phase 0 | 1-2é€± | âŒ | ãªã— | ğŸ”´ æœ€é«˜ |
| Phase 1 | 2-3é€± | ä¸€éƒ¨ | Phase 0 | ğŸ”´ æœ€é«˜ |
| Phase 2 | 3-4é€± | âŒ | Phase 1 | ğŸŸ  é«˜ |
| Phase 3 | 3-4é€± | âœ… | Phase 1 | ğŸŸ  é«˜ |
| Phase 4 | 2-3é€± | âœ… | Phase 1 | ğŸŸ¡ ä¸­ |
| Phase 5 | 4-5é€± | âŒ | Phase 2,3,4 | ğŸ”´ æœ€é«˜ |
| Phase 6 | 3-4é€± | âœ… | Phase 5 | ğŸŸ¡ ä¸­ |
| Phase 7 | 2-3é€± | âœ… | Phase 3 | ğŸŸ¡ ä¸­ |
| Phase 8 | å¤‰å‹• | âœ… | Phase 1 | ğŸŸ¢ ä½ |
| Phase 9 | 2é€± | âŒ | Phase 5 | ğŸŸ¢ ä½ |
| Phase 10 | 1-2é€± | âŒ | All | ğŸŸ¡ ä¸­ |

---

## 7. æŠ€è¡“çš„ãƒªã‚¹ã‚¯ã¨ç·©å’Œç­–

### ãƒªã‚¹ã‚¯1: Super Agent ABI ã®ä¸å®‰å®šæ€§
**ç·©å’Œç­–**: Phase 6å‰ã«APIãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆç¢ºèªã€ç‹¬è‡ªãƒ—ãƒ©ãƒ³ãƒŠãƒ¼å…ˆè¡Œå®Ÿè£…

### ãƒªã‚¹ã‚¯2: MCP Gateway ã®å¯ç”¨æ€§
**ç·©å’Œç­–**: Phase 3å‰ã«æ¥ç¶šãƒ†ã‚¹ãƒˆã€ãƒãƒ¼ãƒ‰ã‚³ãƒ¼ãƒ‰ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯

### ãƒªã‚¹ã‚¯3: è¤‡æ•°ã‚¢ãƒ€ãƒ—ã‚¿ãƒ¼ã®äº’æ›æ€§
**ç·©å’Œç­–**: å„CLIæœ€æ–°ä»•æ§˜ç¢ºèªã€ç‹¬ç«‹ãƒ†ã‚¹ãƒˆã‚¹ã‚¤ãƒ¼ãƒˆ

### ãƒªã‚¹ã‚¯4: Shell Guard ã®èª¤æ¤œçŸ¥/æ¼ã‚Œ
**ç·©å’Œç­–**: åŒ…æ‹¬çš„ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ã€ã‚³ãƒŸãƒ¥ãƒ‹ãƒ†ã‚£ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯

---

## 8. æˆåŠŸåŸºæº– (Definition of Done)

### MVP (Phase 0-5)
- [ ] `pnpm turbo run build lint test` å…¨æˆåŠŸ
- [ ] Ollama + Claude Code ã§ E2E ãƒ•ãƒ­ãƒ¼å®Œèµ°
- [ ] Shell Guard ãŒå±é™ºã‚³ãƒãƒ³ãƒ‰ã‚’ãƒ–ãƒ­ãƒƒã‚¯
- [ ] TUI ã§ã‚¿ã‚¹ã‚¯é€²è¡Œå¯è¦–åŒ–
- [ ] `--json` ãƒ¢ãƒ¼ãƒ‰ã§æ§‹é€ åŒ–ãƒ­ã‚°å‡ºåŠ›

### Full Release (Phase 0-10)
- [ ] 3ç¨®é¡ä»¥ä¸Šã®ãƒ‰ãƒ©ã‚¤ãƒãƒ¼å‹•ä½œ
- [ ] 3ç¨®é¡ä»¥ä¸Šã®ã‚¢ãƒ€ãƒ—ã‚¿ãƒ¼å‹•ä½œ
- [ ] Super Agent/MindBase çµ±åˆ
- [ ] ãƒ™ãƒ³ãƒãƒãƒ¼ã‚¯çµæœå…¬é–‹
- [ ] ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆå®Œå‚™

---

## 9. æ¬¡ã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³

### å³åº§ã«é–‹å§‹
```bash
# ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹é€ ä½œæˆ
mkdir -p packages/{types,policies,sandbox,drivers,adapters,mcp/{client,registry},runners,super-agent,mindbase,ux}
mkdir -p apps/airiscode-cli
mkdir -p tools/make

# åˆæœŸãƒ•ã‚¡ã‚¤ãƒ«ä½œæˆ
touch pnpm-workspace.yaml turbo.json tsconfig.base.json
```

### ãƒ–ãƒ©ãƒ³ãƒæˆ¦ç•¥
- `main`: å®‰å®šç‰ˆ
- `develop`: çµ±åˆãƒ–ãƒ©ãƒ³ãƒ
- `feature/*`: æ©Ÿèƒ½é–‹ç™º

### åˆå›ã‚¹ãƒ—ãƒªãƒ³ãƒˆ
Phase 0-1 ã‚’ 2-3é€±é–“ã§å®Œäº†

---

## 10. ç·è¦‹ç©ã‚‚ã‚Š

- **ç·æœŸé–“**: 30-40é€± (ç´„7-10ãƒ¶æœˆ)
- **æ¨å¥¨ãƒãƒ¼ãƒ ã‚µã‚¤ã‚º**: 3-4åã®ãƒ•ãƒ«ã‚¿ã‚¤ãƒ é–‹ç™ºè€…
- **æœ€å°MVP**: Phase 0-5 (ç´„15-20é€±)

---

## 11. è£œè¶³: gRPC ç§»è¡Œè¨ˆç”» (Phase 11, å°†æ¥)

1. **protoå®šç¾©**: ARCHTECHTURE.mdã®proto3å®šç¾©ã‚’`proto/`ã«é…ç½®
2. **bufå°å…¥**: buf.buildã§ã‚¹ã‚­ãƒ¼ãƒç®¡ç†
3. **è¨€èªåˆ¥ãƒã‚¤ãƒ³ãƒ‡ã‚£ãƒ³ã‚°**: ts-proto (TS), prost (Rust)
4. **å¾Œæ–¹äº’æ›æ€§**: JSON/gRPCä¸¡æ–¹ã‚µãƒãƒ¼ãƒˆ
